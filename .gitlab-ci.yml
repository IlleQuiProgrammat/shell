image: node:latest

before_script:
  - npm install --progress=false

stages:
  - Build
  - Deploy
  - Lint

builder:
  stage: Build
  script:
    - CI=false npm run build
  cache:
    paths:
      - node_modules/
  artifacts:
    paths:
    - build

deploy staging:
  stage: Deploy
  image: debian:latest
  environment: Staging
  only:
    - master
  before_script:
    - apt-get update -qq && apt-get install -y -qq sshpass
  script:
    - export SSHPASS=$USER_PASS
    - sshpass -e scp -o stricthostkeychecking=no -r build gitlab@git.bsnk.me:/srv/ractf

linter:
  stage: Lint
  cache:
    paths:
      - node_modules/
  script:
    - npm run build
